<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Private Tour Detail - VN to You Tour</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>
    <header>
        <div id="header-placeholder"></div>
    </header>

    <div class="content-wrapper">
        <div class="main-content">
            <div class="content-container">
                <div id="back-navigation">
                    <a href="private-tours.html" class="btn">← Back to Private Tours</a>
                </div>
                
                <div id="tour-content">
                    <!-- Tour content will be loaded here -->
                </div>
            </div>
        </div>
        
        <div class="sidebar">
            <div id="sidebar-content">
                <!-- Sidebar content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <footer>
        <div id="footer-placeholder"></div>
    </footer>

    <!-- Load header and footer -->
    <script>
        fetch('../includes/header.html')
        .then(response => response.text())
        .then(data => {
            data = data.replace('href="/', 'href="../');
            data = data.replace('href="/pages/', 'href="');
            document.getElementById('header-placeholder').innerHTML = data;
        });

        fetch('../includes/footer.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('footer-placeholder').innerHTML = data;
        });
    </script>

    <!-- Load data and render tour -->
    <script src="../assets/js/data/private-tours-data.js"></script>
    <script src="../assets/js/renderers/private-tour-renderer.js"></script>
    <script>
        // Prevent all other sidebar auto-inits
        window.sidebarInitialized = true;
        window.tourSidebarInitialized = true;
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== SIMPLE Tour Detail Loaded ===');
            
            // Update status - removed testing sidebar references
            
            // Render tour content
            renderPrivateTourPage();
            
            // Simple sidebar after delay
            setTimeout(() => {
                const sidebarContainer = document.getElementById('sidebar-content');
                const urlParams = new URLSearchParams(window.location.search);
                const tourId = urlParams.get('id');
                
                console.log('Tour ID:', tourId);
                console.log('Data available:', typeof privateToursData !== 'undefined');
                
                if (sidebarContainer && tourId && typeof privateToursData !== 'undefined') {
                    const currentTour = privateToursData.find(t => t.id === tourId);
                    const relatedTours = privateToursData.filter(t => 
                        t.id !== tourId && t.region === (currentTour ? currentTour.region : 'central')
                    );
                    
                    let html = `
                        <div class="sidebar-widget">
                            <h3><i class="fas fa-route"></i> Related Tours</h3>
                            <ul class="sidebar-tours-list">
                    `;
                    
                    if (currentTour) {
                        // Update back navigation
                        const backNav = document.getElementById('back-navigation');
                        if (backNav) {
                            backNav.innerHTML = `<a href="private-tours.html#${currentTour.region}" class="btn">← Back to ${currentTour.region.charAt(0).toUpperCase() + currentTour.region.slice(1)} Vietnam Tours</a>`;
                        }
                    }
                    
                    if (relatedTours.length > 0) {
                        relatedTours.slice(0, 3).forEach(tour => {
                            // Adjust image URL to relative path
                            let imageUrl = tour.image ? tour.image.url : '';
                            if (imageUrl.startsWith('/')) {
                                imageUrl = '..' + imageUrl;
                            }
                            
                            const thumbnailHtml = tour.image ? `
                                <div class="sidebar-tour-thumb">
                                    <img src="${encodeURI(imageUrl)}" alt="${tour.image.alt}" class="sidebar-tour-image" loading="lazy">
                                </div>
                            ` : '';
                            
                            html += `
                                <li class="sidebar-tour-item" style="display: block; flex-direction: column; margin-bottom: 20px; padding: 15px; background: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 8px;">
                                    <a href="private-tour-detail.html?id=${tour.id}" class="sidebar-tour-link" style="display: block; text-decoration: none; color: inherit;">
                                        ${thumbnailHtml ? `
                                        <div style="margin-bottom: 10px;">
                                            <img src="${encodeURI(imageUrl)}" alt="${tour.image.alt}" loading="lazy" style="width: 100%; height: auto; aspect-ratio: 4/3; object-fit: cover; border-radius: 4px;">
                                        </div>
                                        ` : ''}
                                        <div class="sidebar-tour-info">
                                            <h4 class="sidebar-tour-title" style="margin: 0 0 5px 0; font-size: 14px; line-height: 1.3; color: #333;">${tour.title}</h4>
                                            <p class="sidebar-tour-meta" style="margin: 0; font-size: 12px; color: #666;">${tour.duration.display} | ${tour.price.display}</p>
                                        </div>
                                    </a>
                                </li>
                            `;
                        });
                    } else {
                        html += '<li><p><em>No related tours available.</em></p></li>';
                    }
                    
                    html += `
                            </ul>
                        </div>

                        <div class="sidebar-widget">
                            <h3><i class="fas fa-phone"></i> Book This Tour</h3>
                            <p>Contact us for customized booking:</p>
                            <div class="contact-buttons">
                                <a href="https://wa.me/84977632673" target="_blank" class="btn btn-small">
                                    <i class="fab fa-whatsapp"></i> WhatsApp
                                </a>
                                <a href="mailto:sales@vntoyoutour.com" class="btn btn-small">
                                    <i class="fas fa-envelope"></i> Email
                                </a>
                            </div>
                        </div>
                    `;
                    
                    sidebarContainer.innerHTML = html;
                    
                    console.log('SUCCESS: Sidebar created with', relatedTours.length, 'related tours');
                } else {
                    console.log('ERROR: Missing requirements');
                }
            }, 1000);
        });
    </script>
</body>
</html>